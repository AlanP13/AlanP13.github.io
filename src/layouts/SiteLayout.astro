---
import "../styles/global.css";
const { title, description, hideNavOnMobile = false } = Astro.props;
---

<!doctype html>
<html lang="en" data-theme="dark" data-accent="teal">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title ?? "Alan Palayil"}</title>
    {description && <meta name="description" content={description} />}

    <!-- Favicon / App Icon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Light / Dark PNG fallbacks -->
    <link
      rel="icon"
      type="image/png"
      href="/favicon-light.png"
      media="(prefers-color-scheme: light)"
    />
    <link
      rel="icon"
      type="image/png"
      href="/favicon-dark.png"
      media="(prefers-color-scheme: dark)"
    />

    <!-- Apple / iOS -->
    <link rel="apple-touch-icon" href="/favicon-light.png" />

    <!-- OpenGraph / social preview -->
    <meta property="og:image" content="/favicon-light.png" />

    <script is:inline>
      // Persist theme + accent (runs before paint)
      const storedTheme = localStorage.getItem("theme");
      const storedAccent = localStorage.getItem("accent");
      if (storedTheme) document.documentElement.dataset.theme = storedTheme;
      if (storedAccent) document.documentElement.dataset.accent = storedAccent;
    </script>
  </head>
  <body>
    <div class="starfield"></div>

    <header class="wrap">
      <nav class="nav">
        <a class="brand" href="/" aria-label="Home">
          <img src="/logo.svg" alt="Alan Palayil" class="logo-img" />
        </a>

        <!-- Desktop links -->
        <div class="links">
          <a href="/projects">Projects</a>
          <a href="/about">About</a>
          <a href="/resume">Resume</a>
          <a href="/research">Research</a>
        </div>

        <div class="actions">
          <!-- Mobile menu button -->
          <button
            class="chip menu"
            data-action="toggle-menu"
            type="button"
            aria-expanded="false"
            aria-controls="nav-drawer"
          >
            Menu
          </button>

          <button class="chip" data-action="toggle-theme" type="button">Theme</button>
          <button class="chip" data-action="toggle-accent" type="button">Accent</button>
        </div>

        <!-- Mobile drawer -->
        <div class="drawer" id="nav-drawer" hidden>
          <a href="/projects">Projects</a>
          <a href="/about">About</a>
          <a href="/resume">Resume</a>
          <a href="/research">Research</a>
        </div>
      </nav>
    </header>

    <main class="wrap main">
      <slot />
    </main>

    <footer class="wrap foot">
      <p>© {new Date().getFullYear()} Alan Palayil • Built with Astro • All graphics are personally drawn</p>
    </footer>

    <script is:inline>
      const root = document.documentElement;

      function setTheme(next) {
        root.dataset.theme = next;
        localStorage.setItem("theme", next);
      }
      function setAccent(next) {
        root.dataset.accent = next;
        localStorage.setItem("accent", next);
      }

      document.querySelector('[data-action="toggle-theme"]')?.addEventListener("click", () => {
        const cur = root.dataset.theme || "dark";
        setTheme(cur === "dark" ? "light" : "dark");
      });

      document.querySelector('[data-action="toggle-accent"]')?.addEventListener("click", () => {
        const cur = root.dataset.accent || "teal";
        setAccent(cur === "teal" ? "purple" : "teal");
      });

      // Mobile nav drawer logic
      const menuBtn = document.querySelector('[data-action="toggle-menu"]');
      const drawer = document.getElementById("nav-drawer");

      menuBtn?.addEventListener("click", () => {
        if (!drawer) return;
        const isOpen = !drawer.hasAttribute("hidden");

        if (isOpen) {
          drawer.setAttribute("hidden", "");
          drawer.style.display = "none";
          menuBtn.setAttribute("aria-expanded", "false");
        } else {
          drawer.removeAttribute("hidden");
          drawer.style.display = "block";
          menuBtn.setAttribute("aria-expanded", "true");
        }
      });

      // Close drawer on link click
      drawer?.querySelectorAll("a").forEach(a => {
        a.addEventListener("click", () => {
          drawer.setAttribute("hidden", "");
          drawer.style.display = "none";
          menuBtn?.setAttribute("aria-expanded", "false");
        });
      });

      // Close drawer when resizing back to desktop
      window.addEventListener("resize", () => {
        if (window.innerWidth > 720 && drawer && !drawer.hasAttribute("hidden")) {
          drawer.setAttribute("hidden", "");
          drawer.style.display = "none";
          menuBtn?.setAttribute("aria-expanded", "false");
        }
      });
    </script>

    <style>
      .wrap {
        max-width: 1120px;
        margin: 0 auto;
        padding: 32px 28px;
      }
      .main {
        padding-top: 72px;
        padding-bottom: 96px;
      }
      .nav {
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:16px;
        padding: 14px 16px;
        border: 1px solid rgb(var(--border));
        border-radius: var(--r);
        background: rgba(255,255,255,0.02);
        backdrop-filter: blur(8px);
        flex-wrap: wrap;
      }
      .brand {
        display: flex;
        align-items: center;
        text-decoration: none;
        line-height: 0;
      }

      .logo-img {
        height: 55px;
        width: auto;
        display: block;
      }

      /* logo is black by default; invert in dark mode to appear white */
      :root[data-theme="dark"] .logo-img { filter: invert(1); }
      :root[data-theme="light"] .logo-img { filter: invert(0); }

      .links {
        display:flex;
        gap:14px;
        flex-wrap:wrap;
      }

      .links a {
        text-decoration:none;
        color: rgb(var(--muted));
      }

      .links a:hover {
        color: rgb(var(--text));
      }

      .actions {
        display:flex;
        gap:10px;
      }

      .chip {
        border: 1px solid rgb(var(--border));
        background: rgba(255,255,255,0.02);
        color: rgb(var(--text));
        border-radius: 999px;
        padding: 8px 10px;
        cursor: pointer;
      }

      .chip:hover {
        border-color: rgb(var(--accent));
      }

      /* Mobile menu */
      .menu { display: none; }

      .drawer {
        display: none;
        width: 100%;
        margin-top: 12px;
        padding: 10px;
        border: 1px solid rgb(var(--border));
        border-radius: 14px;
        background: rgba(255,255,255,0.03);
      }

      .drawer a {
        display: block;
        padding: 10px 10px;
        border-radius: 10px;
        text-decoration: none;
        color: rgb(var(--text));
      }

      .drawer a:hover {
        background: rgba(255,255,255,0.04);
      }

      @media (max-width: 720px) {
        .links { display: none; }
        .menu { display: inline-flex; }
      }

      .foot {
        padding-bottom: 32px;
        color: rgb(var(--muted));
        font-size: 13px;
      }
    </style>
  </body>
</html>