---
import SiteLayout from "../layouts/SiteLayout.astro";
import ImageCarousel from "../components/ImageCarousel";

// Auto-import ALL images in src/assets/about
const modules = import.meta.glob("../assets/places/*.{jpg,jpeg,png,webp,avif}", {
  eager: true,
});

// Build: { src, name } from file name
const placeImages = Object.entries(modules)
  .map(([filePath, mod]) => {
    const file = filePath.split("/").pop() ?? "";
    const name = decodeURIComponent(file)
      .replace(/\.[^.]+$/, "")
      .replace(/[-_]+/g, " ")
      .trim();

    // Astro asset modules expose default with .src
    const src = (mod as { default: { src: string } }).default.src;

    return { src, name };
  })
  .sort((a, b) => a.name.localeCompare(b.name));
---

<SiteLayout
  title="About — Alan Palayil"
  description="Enterprise engineering, data systems, and applied research focus."
>
  <section class="about">
    <h1>About Me</h1>

    <div class="heroGrid">
      <div class="left prose">
        <p>
          Hey! I’m
          <a
            href="https://www.instagram.com/alan.palayil/"
            target="_blank"
            rel="noopener noreferrer"
            class="dotted-link"
            >Alan Palayil</a
          >, an <strong>Enterprise Data Engineer</strong> working at the
          intersection of <strong>Financial Systems</strong>,
          <strong>Cloud Platforms</strong>, and <strong>Data Reliability</strong>.
          My work focuses on modernizing investment accounting workflows by
          building scalable, production-grade pipelines that prioritize
          <strong>accuracy</strong>, <strong>auditability</strong>, and
          <strong>long-term maintainability</strong>.
        </p>

        <p>
          I currently work at
          <a
            href="https://www.genworth.com"
            target="_blank"
            rel="noopener noreferrer"
            class="dotted-link"
            >Genworth Financial</a
          >, where I own and support critical accounting platforms across
          <strong>Fixed Income</strong>, <strong>Derivatives</strong>, and
          <strong>Commercial Mortgage Loans</strong>, collaborating closely with
          Accounting, Operations, and Infrastructure teams to deliver systems that
          are both technically robust and business-critical.
        </p>

        <p>
          Alongside my professional work, I’m pursuing a
          <a
            href="https://www.ucumberlands.edu/academics/graduate/phd-information-technology"
            target="_blank"
            rel="noopener noreferrer"
            class="dotted-link"
            >PhD in Information Technology</a
          >
          with a focus on <strong>AI</strong> and <strong>Data Science</strong>,
          centered on applying intelligent, data-driven techniques to enterprise
          systems and automation.
        </p>

        <p>
          Outside of work, I enjoy <strong>Painting</strong>,
          <strong>Digital Art</strong>, <strong>3D Printing</strong>,
          <strong>Gaming</strong>, and building
          <a href="/projects" class="dotted-link">Creative Projects</a>
          that blend engineering with design.
        </p>

        <div class="socialRow" aria-label="Social links">
          <a class="social" href="https://github.com/AlanP13" target="_blank" rel="noreferrer">
            <span class="icon" aria-hidden="true">…</span>
            GitHub
          </a>

          <span class="sep" aria-hidden="true">|</span>

          <a class="social" href="https://www.linkedin.com/in/alan-palayil/" target="_blank" rel="noreferrer">
            <span class="icon" aria-hidden="true">…</span>
            LinkedIn
          </a>

          <span class="sep" aria-hidden="true">|</span>

          <a class="social" href="mailto:alanpalayil+portfolio@gmail.com" target="_blank" rel="noreferrer">
            <span class="icon" aria-hidden="true">…</span>
            Email
          </a>
        </div>
      </div>

      <div class="right">
        <ImageCarousel
          client:idle
          images={[
            "/about/alan-1.jpg",
            "/about/alan-2.jpg",
            "/about/alan-3.jpg",
            "/about/alan-4.jpg",
          ]}
        />
      </div>
    </div>
  </section>

  <section class="gallery">
    <h2 class="galleryTitle">Some of the iconic places I've visited!</h2>

    <div class="grid" id="placesGallery" data-rotating>
      {placeImages.slice(0, 6).map((img) => (
        <div class="imgCard">
          <img src={img.src} alt={img.name} loading="lazy" />
          <div class="imgLabel">{img.name}</div>
        </div>
      ))}
    </div>

    <p class="muted">
      Images Presented: <strong>{placeImages.length}</strong>
    </p>

    <script define:vars={{ placeImages }}>
      const VISIBLE = 6;
      const INTERVAL = 7500;
      const FADE_MS = 750;

      let index = 0;
      const container = document.getElementById("placesGallery");
      const cards = Array.from(container.querySelectorAll(".imgCard"));
      const count = Math.min(VISIBLE, cards.length);

      function setCard(card, img) {
        const imageEl = card.querySelector("img");
        const labelEl = card.querySelector(".imgLabel");

        card.classList.add("is-fading");

        setTimeout(() => {
          imageEl.src = img.src;
          imageEl.alt = img.name;
          labelEl.textContent = img.name;
          card.classList.remove("is-fading");
        }, FADE_MS);
      }

      function tick() {
        if (!placeImages?.length) return;

        index = (index + 1) % placeImages.length;

        for (let i = 0; i < count; i++) {
          const img = placeImages[(index + i) % placeImages.length];
          setCard(cards[i], img);
        }
      }

      requestAnimationFrame(() => setInterval(tick, INTERVAL));
    </script>
  </section>

  <style>
    .about { padding-top: 44px; padding-bottom: 24px; }

    h1 {
      margin: 0 0 18px;
      font-size: 44px;
      letter-spacing: -0.03em;
      color: rgb(var(--accent));
      font-weight: 800;
    }

    p { color: rgb(var(--muted)); text-align: justify; }
    p strong { color: rgb(var(--accent)); }

    .dotted-link {
      font-weight: 700;
      color: rgb(var(--accent));
      text-decoration: underline dotted;
      text-underline-offset: 6px;
    }
    .dotted-link:hover { text-decoration: underline solid; }

    .socialRow {
      margin-top: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      color: rgb(var(--muted));
      font-size: 14px;
    }
    .social {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: rgb(var(--text));
      opacity: 0.95;
    }
    .social:hover { color: rgb(var(--accent)); }
    .icon { color: rgb(var(--accent)); display: inline-flex; }
    .sep { color: rgb(var(--muted)); opacity: 0.7; margin: 0 8px; }

    .heroGrid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
      align-items: start;
    }
    @media (min-width: 980px) {
      .heroGrid { grid-template-columns: 6fr 1fr; gap: 44px; }
    }
    .right {
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
      width: 100%;
    }

    .gallery { margin-top: 26px; padding-top: 12px; }
    .galleryTitle {
      margin: 0 0 12px;
      font-size: 16px;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      color: rgb(var(--muted));
    }

    .grid { display: grid; grid-template-columns: 1fr; gap: 14px; }
    @media (min-width: 760px) {
      .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .imgCard {
      border: 1px solid rgb(var(--border));
      border-radius: var(--r);
      overflow: hidden;
      background: rgba(255, 255, 255, 0.02);
      position: relative;
      transition: transform 120ms ease, border-color 120ms ease;
    }
    .imgCard:hover { transform: translateY(-2px); border-color: rgb(var(--accent)); }

    .imgCard img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      display: block;
      transition: opacity 450ms ease, transform 450ms ease;
      will-change: opacity, transform;
    }

    .imgLabel {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 12px 10px 20px;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.02em;
      color: rgb(var(--text));
      background: linear-gradient(
        to top,
        rgba(0, 0, 0, 0.65),
        rgba(0, 0, 0, 0.15),
        transparent
      );
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 160ms ease, transform 160ms ease;
    }

    .imgLabel::before {
      content: "";
      position: absolute;
      left: 8px;
      top: 10px;
      bottom: 10px;
      width: 3px;
      border-radius: 999px;
      background: rgb(var(--accent));
      opacity: 0.9;
    }

    .imgCard:hover .imgLabel { opacity: 1; transform: translateY(0); }

    .imgCard.is-fading img,
    .imgCard.is-fading .imgLabel {
      opacity: 0;
      transform: translateY(2px);
    }

    @media (hover: none) {
      .imgLabel { opacity: 1; transform: none; }
    }
  </style>
</SiteLayout>
